<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script>(function(){var e="@charset \"utf-8\";html{color:#000;background:#fff;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}html *{outline:0;-webkit-text-size-adjust:none;-webkit-tap-highlight-color:rgba(0,0,0,0)}html,body{font-family:sans-serif}body,div,dl,dt,dd,ul,ol,li,h1,h2,h3,h4,h5,h6,pre,code,form,fieldset,legend,input,textarea,p,blockquote,th,td,hr,button,article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{margin:0;padding:0}input,select,textarea{font-size:100%}table{border-collapse:collapse;border-spacing:0}fieldset,img{border:0}abbr,acronym{border:0;font-variant:normal}del{text-decoration:line-through}address,caption,cite,code,dfn,em,th,var{font-style:normal;font-weight:500}ol,ul{list-style:none}caption,th{text-align:left}h1,h2,h3,h4,h5,h6{font-size:100%;font-weight:500}q:before,q:after{content:''}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}a:hover{text-decoration:underline}ins,a{text-decoration:none}",t=document.createElement("style");if(document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet)t.styleSheet.disabled||(t.styleSheet.cssText=e);else try{t.innerHTML=e}catch(o){t.innerText=e}})();(function(e,t){function i(){var t=n.getBoundingClientRect().width;t/m>540&&(t=540*m);var i=t/10;n.style.fontSize=i+"px",d.rem=e.rem=i}var a,r=e.document,n=r.documentElement,o=r.querySelector('meta[name="viewport"]'),l=r.querySelector('meta[name="flexible"]'),m=0,s=0,d=t.flexible||(t.flexible={});if(o){console.warn("将根据已有的meta标签来设置缩放比例");var p=o.getAttribute("content").match(/initial\-scale=([\d\.]+)/);p&&(s=parseFloat(p[1]),m=parseInt(1/s))}else if(l){var c=l.getAttribute("content");if(c){var u=c.match(/initial\-dpr=([\d\.]+)/),f=c.match(/maximum\-dpr=([\d\.]+)/);u&&(m=parseFloat(u[1]),s=parseFloat((1/m).toFixed(2))),f&&(m=parseFloat(f[1]),s=parseFloat((1/m).toFixed(2)))}}if(!m&&!s){var v=(e.navigator.appVersion.match(/android/gi),e.navigator.appVersion.match(/iphone/gi)),h=e.devicePixelRatio;m=v?h>=3&&(!m||m>=3)?3:h>=2&&(!m||m>=2)?2:1:1,s=1/m}if(n.setAttribute("data-dpr",m),!o)if(o=r.createElement("meta"),o.setAttribute("name","viewport"),o.setAttribute("content","initial-scale="+s+", maximum-scale="+s+", minimum-scale="+s+", user-scalable=no"),n.firstElementChild)n.firstElementChild.appendChild(o);else{var x=r.createElement("div");x.appendChild(o),r.write(x.innerHTML)}e.addEventListener("resize",function(){clearTimeout(a),a=setTimeout(i,300)},!1),e.addEventListener("pageshow",function(e){e.persisted&&(clearTimeout(a),a=setTimeout(i,300))},!1),"complete"===r.readyState?r.body.style.fontSize=12*m+"px":r.addEventListener("DOMContentLoaded",function(e){r.body.style.fontSize=12*m+"px"},!1),i(),d.dpr=e.dpr=m,d.refreshRem=i,d.rem2px=function(e){var t=parseFloat(e)*this.rem;return"string"==typeof e&&e.match(/rem$/)&&(t+="px"),t},d.px2rem=function(e){var t=parseFloat(e)/this.rem;return"string"==typeof e&&e.match(/px$/)&&(t+="rem"),t}})(window,window.lib||(window.lib={}));</script>
    <title>广州助银秘书</title>
    <link rel="stylesheet" href="<?php echo base_url('static/m/css/newBind.css'); ?>">
    <link rel="stylesheet" href="<?php echo base_url('static/m/fonts/iconfont.css'); ?>">
</head>
<body>
    <div class="container">
        <div class="img_wrap">
            <img src="<?php echo base_url('static/m/images/daibei.png'); ?>" alt="">
        </div>
        <p class="daibei">立即获取您的详细贷款信息</p>
        <div class="form_wrap">
            <form action="<?php echo site_url('Weixin/handleBind');?>" id="bind_form" method="post">
                <div class="item">
                    <span>
                        <i class="iconfont icon-user"></i>                        
                    </span>
                    <input type="text" placeholder="请输入您的真实姓名" name="name">
                </div>
                <div class="item">
                    <span>
                        <i class="iconfont icon-identity"></i>                        
                    </span>
                    <input type="text" placeholder="请输入您的身份证号码" name="identity">
                </div>
                <div class="item codeItem">
                    <span>
                        <i class="iconfont icon-phone"></i>                        
                    </span>
                    <input type="text" placeholder="请输入您的手机号码" name="phone" id="phone">
                    <a href="javascript:void(0)" id="getCode" class="getCode w_disabled">获取验证码</a>
                </div>
                <div class="item">
                    <span>
                        <i class="iconfont icon-code"></i>                        
                    </span>
                    <input type="text" placeholder="请输入您收到的验证码" name="code" id="code">
                    <label for="" id="c_error" style="display:none">验证码不正确</label>
                </div>
                <div  style="display:none">
                    <input type="text" name="openid" value="<?php if(isset($openid)){
                        echo $openid;
                    }?>">
                </div>
                <div class="item submitItem">
                    <button class="submit" type="submit" >立即绑定</button>
                </div>
                <?php csrf_hidden();?>
            </form>
        </div>
    </div>
    <div class="footer">
            <p>版权所有 ©贷呗金融 未经许可不得复制,违者必究!</p>
            <p class="weui-footer__text">Copyright © Daibei Finance Co., Ltd. All Rights Reserved</p>
    </div>
</body>
<script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/jquery-validate/1.17.0/jquery.validate.min.js"></script>
<script>
    $(function () {
        function isIdCardNo(num) {
            var factorArr = new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1);
            var parityBit=new Array("1","0","X","9","8","7","6","5","4","3","2");
            var varArray = new Array();
            var intValue;
            var lngProduct = 0;
            var intCheckDigit;
            var intStrLen = num.length;
            var idNumber = num;
            // initialize
            if ((intStrLen != 15) && (intStrLen != 18)) {
            return false;
            }
            // check and set value
            for(i=0;i<intStrLen;i++) {
            varArray[i] = idNumber.charAt(i);
            if ((varArray[i] < '0' || varArray[i] > '9') && (i != 17)) {
            return false;
            } else if (i < 17) {
            varArray[i] = varArray[i] * factorArr[i];
            }
            }
            if (intStrLen == 18) {
            //check date
            var date8 = idNumber.substring(6,14);
            if (isDate8(date8) == false) {
            return false;
            }
            // calculate the sum of the products
            for(i=0;i<17;i++) {
            lngProduct = lngProduct + varArray[i];
            }
            // calculate the check digit
            intCheckDigit = parityBit[lngProduct % 11];
            // check last digit
            if (varArray[17] != intCheckDigit) {
            return false;
            }
            }
            else{ //length is 15
            //check date
            var date6 = idNumber.substring(6,12);
            if (isDate6(date6) == false) {
            return false;
            }
            }
            return true;
            }
            function isDate6(sDate) {
            if(!/^[0-9]{6}$/.test(sDate)) {
            return false;
            }
            var year, month, day;
            year = sDate.substring(0, 4);
            month = sDate.substring(4, 6);
            if (year < 1700 || year > 2500) return false
            if (month < 1 || month > 12) return false
            return true
            }
            function isDate8(sDate) {
            if(!/^[0-9]{8}$/.test(sDate)) {
            return false;
            }
            var year, month, day;
            year = sDate.substring(0, 4);
            month = sDate.substring(4, 6);
            day = sDate.substring(6, 8);
            var iaMonthDays = [31,28,31,30,31,30,31,31,30,31,30,31]
            if (year < 1700 || year > 2500) return false
            if (((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0)) iaMonthDays[1]=29;
            if (month < 1 || month > 12) return false
            if (day < 1 || day > iaMonthDays[month - 1]) return false
            return true
            }
        //自定义手机号验证
        jQuery.validator.addMethod("isphoneNum", function (value, element) {
            var length = value.length;
            var mobile = /^1[3|5|8]{1}[0-9]{9}$/;
            return this.optional(element) || (length == 11 && mobile.test(value));
        }, "请正确填写您的手机号码");
        // 身份证号码验证 
        jQuery.validator.addMethod("idcardno", function (value, element) {
            return this.optional(element) || isIdCardNo(value);
        }, "请正确输入身份证号码");

        $("#bind_form").validate({
            rules: {
                name: {
                    required: true,
                    minlength: 2
                },
                identity: {
                    required: true,
                    idcardno:true,
                    maxlength: 18,
                    maxlength: 18,
                },
                phone: {
                    required: true,
                    maxlength: 11,
                    maxlength: 11,
                    isphoneNum: true
                },
                code: {
                    required: true,
                    digits: true,
                    maxlength: 4,
                    maxlength: 4,
                }
            },
            messages: {
                name: {
                    required: "*请输入用户名",
                    minlength: "用户名必需由两个字母组成"
                },
                identity: {
                    required: "*请输入身份证号",
                    idcardno:"*请检查您的身份证号码",
                    maxlength: "*请填写18位的身份证号码",
                    minlength: "请填写18位的身份证号码",
                },
                phone: {
                    required: "*请输入手机号",
                    maxlength: "*请填写11位的手机号",
                    minlength: "*请填写11位的手机号",
                    isphoneNum: "请填写正确的手机号码",

                },
                code: {
                    required: "*请输入验证码",
                    digits: "请输入正确的数字",
                    maxlength: "*请输入4位的验证码",
                    minlength: "*请输入4位的验证码"
                }
            }
        });
        // 获取验证码
        var datacode=null;
        var timeCount = 60;
        $("#getCode").click(function (e) {
            $this = $(this);
            if (!$this.hasClass("w_disabled")) {
                $this.addClass("w_disabled sending");
                $.ajax({
                    url: '<?php echo site_url("Weixin/sendMessage");?>',
                    type: 'get', //GET
                    async: true, //或false,是否异步
                    cache: true,
                    data: {
                        phone: $("#phone").val()
                    },
                    timeout: 5000, //超时时间
                    dataType: 'json', //返回的数据格式：json/xml/html/script/jsonp/text
                    beforeSend: function (xhr) {

                    },
                    success: function (data, textStatus, jqXHR) {
                         datacode=data.code;
                    },
                    error: function (xhr, textStatus) {

                    },
                    complete: function () {
                        
                    }
                });
                var timer = setInterval(function () {

                    timeCount -= 1;
                    $this.text(timeCount + "s 后重发");
                    if (timeCount == 0) {
                        $this.removeClass("w_disabled sending").text("获取验证码");
                        clearInterval(timer);
                        timeCount = 60;
                    }
                }, 1000)
            } else {
                if ($this.hasClass("sending")) {
                    return
                }
            }
            e.preventDefault();
        });
          // 验证验证码
       
        $("#code").on('input',function (e) {
            var code = $(this).val();
            if(code.length == 0){
                $("#c_error").hide();
            }
            if (code.length == 4) {
                if (code == datacode) {
                   $("#c_error").hide();
                } else {
                    $("#c_error").show();
                }
            }
        });
        $('#phone').on('input', function (e) {
            if ($("#bind_form").validate().element($("#phone"))) {
                $('#getCode').removeClass("w_disabled");
            }
        })
    });
</script>
</html>